---
title: "p8105_hw5_ob2305"
author: "Olya Besedina"
data: "11/04/2019"
output: github_document
---
  
```{r setup, include = FALSE}
library(tidyverse)
library(rvest)
library(viridis)

knitr::opts_chunk$set(
 	echo = TRUE,
 	warning = FALSE,
 	fig.width = 8, 
   fig.height = 6,
   out.width = "90%"
 )

options(
   ggplot2.continuous.colour = "viridis",
   ggplot2.continuous.fill = "viridis"
 )

 scale_colour_discrete = scale_colour_viridis_d
 scale_fill_discrete = scale_fill_viridis_d

 theme_set(theme_minimal() + theme(legend.position = "bottom"))

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

# Problem 1

Count missing values in the df

```{r}
skimr::skim(iris_with_missing)
```

```{r}
iris_with_missing = iris_with_missing %>% janitor::clean_names()

# function for num and char
my_function = function(x) {
  
  if(is.numeric(x)) {
    replace_na(x, mean(x, na.rm = TRUE))
  } else if(is.character(x)) {
    replace_na(x, "virginica")
  }
}
new_iris = map_df(iris_with_missing,my_function)

# check missing values in mapped data frame
sum_na = sum(is.na(new_iris))
names = distinct(new_iris,species)

# in line 
# The `r new_iris` data frame has `r sum_na` missing values. In character variables missing values were replaced withthe mean value of that variable and in character variable they were replaced with "virginica". Character value in the new data frame has three distinct values `r names`.
```



# Problem 2

This zip file contains data from a longitudinal study that included a control arm and an experimental arm. Data for each participant is included in a separate file, and file names include the subject ID and arm.

Create a tidy dataframe containing data from all participants, including the subject ID, arm, and observations over time:

1. Start with a dataframe containing all file names; the list.files function will help

2. Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe

3. Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

4. Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
# Read the files

read_plus <- function(x) {
    read_csv(x) %>% 
        mutate(filename = x)
}

trial =
    list.files(path = "./data/", 
               pattern = "*.csv",
               full.names = TRUE)

trial_df = map_df(trial, read_plus)

# Mutate filename variable

trial_df =
  trial_df %>% 
  mutate(
    filename = str_replace(filename, "./data//", ""),
    filename = str_replace(filename, ".csv", "")
  ) 
# Not sure if needed
#separate(filename, into = c("arm", "subject_id"), sep = "\\_")
  
```









